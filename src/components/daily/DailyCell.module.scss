@use "../../styles/variables.scss" as *;

// =====================================================
// Grid Cell Design Tokens
// =====================================================
$cell-border: 1px solid rgba(0, 0, 0, 0.08); // 격자 테두리
$cell-border-hour: 1px solid rgba(0, 0, 0, 0.15); // 정각 테두리 (더 진하게)
$cell-bg: $c-white;
$cell-bg-hover: rgba($primary-color, 0.08);

// 선택된 상태: 부드러운 블루 + Inner Shadow
$cell-selected-bg: $c-blue;
$cell-selected-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba($primary-color, 0.3);

// 애니메이션
@keyframes popIn {
  0% { transform: scale(0.9); opacity: 0.5; }
  60% { transform: scale(1.05); opacity: 1; }
  100% { transform: scale(1); }
}

@keyframes pulseSoft {
  0% { background-color: rgba($primary-color, 0.4); }
  50% { background-color: rgba($primary-color, 0.2); }
  100% { background-color: rgba($primary-color, 0.4); }
}

.cell {
  user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
  -webkit-tap-highlight-color: transparent;
  
  padding: 0;
  margin: 0;
  border-radius: 0; // 격자 느낌을 위해 둥근 모서리 제거
  
  // 격자 테두리 적용
  border-right: $cell-border;
  border-bottom: $cell-border;
  background: $cell-bg;
  
  transition: all $transition-fast;
  
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  
  height: 30px;
  min-height: 30px;
  width: 100%;
  
  box-sizing: border-box;
  flex-shrink: 0;
  font-size: $font-size-sm;
  color: $c-white;
  touch-action: auto;
  position: relative;

  // 편집 모드에서 hover
  &:hover:not(.selected):not(.hasCount) {
    background: $cell-bg-hover;
  }

  // 탭 시 active 피드백
  &:active {
    background: rgba($primary-color, 0.15);
  }

  // ===== 상태 스타일 =====

  &.selected {
    background: $cell-selected-bg;
    box-shadow: $cell-selected-shadow;
    z-index: 1;
  }

  // 방금 선택된 셀 애니메이션 (Pop effect)
  &.justSelected {
    animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  }

  // 정각 구분선: 더 진한 테두리
  &.fullHour {
    border-top: $cell-border-hour;
  }

  &.halfHour {
    // 30분 단위는 기본 테두리 유지
  }

  // ===== 투표 결과 보기 모드 (Count) =====
  
  // count가 있는 경우: Minty Green 그라데이션
  &.hasCount:not(.selected) {
    background-color: rgba($c-green, calc(0.2 + var(--intensity, 0) * 0.6));
    
    &:hover {
        filter: brightness(1.05);
    }
  }

  // 내 선택 + 다른 사람 선택 겹침: 단색 보라색
  &.hasCount.selected {
    background: rgba($c-purple, 0.5);
    box-shadow: 0 2px 4px rgba($c-purple, 0.3);
  }

  // 뷰어 모드
  &.viewMode {
    cursor: default;
    &:hover {
      background: $cell-bg; // 뷰어 모드에서는 호버 효과 제거
    }
  }

  // ===== 드래그 인터랙션 =====

  // 드래그 중 하이라이트 (선택 모드)
  &.dragHighlighted.dragSelect {
    background: rgba($primary-color, 0.5);
    animation: pulseSoft 1s infinite;
  }

  // 드래그 중 하이라이트 (해제 모드)
  &.dragHighlighted.dragDeselect {
    background: rgba($c-gray, 0.3);
  }
}
