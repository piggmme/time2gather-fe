@use "../../styles/variables.scss" as *;

// =====================================================
// Soft UI / Tactile Design Tokens
// =====================================================
$glass-border-subtle: 1px solid rgba(0, 0, 0, 0.03);
$cell-bg: transparent; // 기본 배경 투명 (컨테이너 배경 사용)
$cell-bg-hover: rgba($primary-color, 0.08);

// 선택된 상태: 부드러운 블루 + Inner Shadow
$cell-selected-bg: $c-blue;
$cell-selected-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba($primary-color, 0.3);

// 애니메이션
@keyframes popIn {
  0% { transform: scale(0.9); opacity: 0.5; }
  60% { transform: scale(1.05); opacity: 1; }
  100% { transform: scale(1); }
}

@keyframes pulseSoft {
  0% { background-color: rgba($primary-color, 0.4); }
  50% { background-color: rgba($primary-color, 0.2); }
  100% { background-color: rgba($primary-color, 0.4); }
}

.cell {
  user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
  -webkit-tap-highlight-color: transparent;
  
  padding: 0; // 패딩 제거하고 flex로 중앙 정렬
  margin: 1px; // 셀 간격 살짝 띄워서 '타일' 느낌 내기
  border-radius: $radius-xs; // 둥근 모서리 적용
  
  border: none; // 보더 대신 갭 사용
  background: $cell-bg;
  
  transition: all $transition-fast;
  
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  
  height: 28px; // 마진 고려하여 높이 조정 (30px -> 28px + 2px margin)
  min-height: 28px;
  width: calc(100% - 2px);
  
  box-sizing: border-box;
  flex-shrink: 0;
  font-size: $font-size-sm;
  color: $c-white;
  touch-action: auto;
  position: relative; // 가상요소 등 활용 가능성

  // 편집 모드에서 hover: 살짝 떠오르는 느낌
  &:hover:not(.selected):not(.hasCount) {
    background: $cell-bg-hover;
    transform: scale(0.95);
    border-radius: $radius-sm;
  }

  // 탭 시 active 피드백 (쫀득함)
  &:active {
    transform: scale(0.9);
  }

  // ===== 상태 스타일 =====

  &.selected {
    background: $cell-selected-bg;
    box-shadow: $cell-selected-shadow;
    border-radius: $radius-sm;
    z-index: 1; // 겹칠 때 위로
  }

  // 방금 선택된 셀 애니메이션 (Pop effect)
  &.justSelected {
    animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  }

  // 정각 구분선: 셀 자체가 떨어져 있으므로 가상요소로 표현하거나 생략 가능
  // 여기서는 배경색으로 미묘하게 구분
  &.fullHour {
    // border-top 생략하고 마진으로 구분
  }

  &.halfHour {
    // 30분 단위는 시각적으로 약하게 처리
    opacity: 0.9;
  }

  // ===== 투표 결과 보기 모드 (Count) =====
  
  // count가 있는 경우: Minty Green 그라데이션
  // 강도(intensity)에 따라 투명도 조절
  &.hasCount:not(.selected) {
    background-color: rgba($c-green, calc(0.2 + var(--intensity, 0) * 0.6));
    border-radius: $radius-sm;
    // 인원수가 많을수록 약간 더 튀어나와 보이게
    transform: scale(calc(0.9 + var(--intensity, 0) * 0.1));
    
    &:hover {
        filter: brightness(1.05);
    }
  }

  // 내 선택 + 다른 사람 선택 겹침: Purple (보색 대비)
  &.hasCount.selected {
    background: linear-gradient(135deg, $c-blue 30%, $c-purple 100%);
    box-shadow: 0 2px 4px rgba($c-purple, 0.3);
  }

  // 뷰어 모드
  &.viewMode {
    cursor: default;
    &:hover {
      transform: none; // 뷰어 모드에서는 호버 효과 제거
    }
  }

  // ===== 드래그 인터랙션 =====

  // 드래그 중 하이라이트 (선택 모드)
  &.dragHighlighted.dragSelect {
    background: rgba($primary-color, 0.5);
    border-radius: $radius-md;
    transform: scale(0.95);
    animation: pulseSoft 1s infinite;
  }

  // 드래그 중 하이라이트 (해제 모드)
  &.dragHighlighted.dragDeselect {
    background: rgba($c-gray, 0.3);
    border-radius: $radius-md;
    transform: scale(0.85);
  }
}
